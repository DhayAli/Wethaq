{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ø§Ù…Ø© */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
        }

        /* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© */
        header {
            background-color: #352872;
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        /* Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .menu-toggle {
            font-size: 1.5rem;
            cursor: pointer;
            position: fixed;
            top: 15px;
            left: 15px;
            color: white;
            background-color: #352872;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .menu-toggle:hover {
            background-color: #5e55bc;
            transform: scale(1.1);
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .offcanvas {
            width: 250px;
            background-color: #352872;
            color: white;
            height: 100%;
            position: fixed;
            top: 80px;
            left: 0;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            z-index: 1100; /* Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¸Ù‡ÙˆØ± ÙÙˆÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        }

        .offcanvas a {
            display: block;
            padding: 15px 20px;
            text-decoration: none;
            color: white;
            font-size: 1rem;
            border-bottom: 1px solid #5e55bc;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
        }

        .offcanvas a:hover {
            background-color: #5e55bc;
            color: white;
            transform: translateX(5px);
            font-weight: bold;
        }

        /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© */
        .content {
            margin-top: 120px;
            padding: 100px;
            text-align: center;
            position: relative;
            z-index: 1000;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .table {
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            z-index: 100;
        }

        .table th {
            background-color: #352872;
            color: white;
            text-align: center;
        }

        .table td {
            text-align: center;
        }

        /* Ø²Ø± Ø§Ù„ØªÙØ§ØµÙŠÙ„ */
        .btn-primary {
            background-color: #352872;
            border: none;
            transition: background-color 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #5e55bc;
        }

        /* Ø§Ù„ÙÙˆØªØ± */
        footer {
            background-color: #352872;
            color: white;
            text-align: center;
            padding: 10px;
            position: fixed;
            bottom: 0;
            width: 100%;
            font-size: 0.9rem;
        }

        /* Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Ø§Ù„Ù…ÙˆØ¯Ø§Ù„) */
        .modal-content {
            direction: rtl;
            border-radius: 10px;
        }

        .modal-header {
            background-color: #352872;
            color: white;
            border-radius: 10px 10px 0 0;
        }

        .modal-footer {
            background-color: #f4f7f6;
            border-radius: 0 0 10px 10px;
        }

        .back-home-btn:hover {
            background-color: #5e55bc;
        }

        .back-home-btn {
            display: inline-block;
            padding: 8px 15px;
            background-color: #352872;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 1rem;
            text-align: center;
            position: fixed;
            bottom: 70px;
            left: 40px;
            cursor: pointer;
            z-index: 900; /* ğŸ”¹ Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù€ sidebar Ø­ØªÙ‰ Ù„Ø§ ÙŠØ¸Ù‡Ø± ÙÙˆÙ‚Ù‡Ø§ */
        }
        .wethaq-logo {
    position: absolute;
    top: -7px;
    right: 20px;
    height: 90px;
    width: auto;
    transition: transform 0.3s ease;
}

.wethaq-logo:hover {
    transform: scale(1.1);
}

    </style>
</head>

<body class="bg-light">

    <header>
        Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª
        <button class="menu-toggle" title="ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©" id="toggleSidebar">â˜°</button>
           <!-- Ø´Ø¹Ø§Ø± ÙˆØ«Ø§Ù‚ -->
       <a href= "{% url 'center_dashboard' %}">
        <img src="{% static 'images/WethaqLogo.png' %}" class="wethaq-logo" alt="Ø´Ø¹Ø§Ø± ÙˆØ«Ø§Ù‚">
    </a>
    </header>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <div class="offcanvas" tabindex="-1" id="sidebar">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <a href="{% url 'center_dashboard' %}">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="{% url 'add_new_detainess' %}">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚ÙˆÙ Ø¬Ø¯ÙŠØ¯</a>
            <a href="{% url 'view_all_files' %}">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„ÙØ§Øª</a>
            <a href="{% url 'search_center_files' %}">Ø¨Ø­Ø« Ø§Ù„Ù…Ù„ÙØ§Øª</a>
            <a href="{% url 'add_new_case' %}">Ø§Ø¶Ø§ÙØ© Ù‚Ø¶ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</a>
        </div>
    </div>

    <div class="container mt-5 content">
        <h2 class="text-center mb-4">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª</h2>
        <div class="card shadow">
            <div class="card-body">
                <table class="table table-striped" id="casesTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
                            <th>Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø¶ÙŠØ©</th>
                            <th>ØªÙØ§ØµÙŠÙ„</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ØªØ¹Ø±Ø¶ Ù‡Ù†Ø§ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„ØªÙØ§ØµÙŠÙ„ -->
    <div class="modal fade" id="fileDetailsModal" tabindex="-1" aria-labelledby="fileDetailsModalLabel">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fileDetailsModalLabel">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù„Ù</h5>

                </div>
                <div class="modal-body" id="modalDetails">
                    <!-- Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø³ØªØ¹Ø±Ø¶ Ù‡Ù†Ø§ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
            </div>
        </div>
    </div>
    <a href="{% url 'center_dashboard' %}" class="back-home-btn">â¬…</a>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const toggleSidebar = document.getElementById('toggleSidebar');
            const sidebar = new bootstrap.Offcanvas(document.getElementById('sidebar'));

            toggleSidebar.addEventListener('click', () => {
                sidebar.toggle();
            });
        });

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø¶ÙŠØ©
        function formatStatus(status) {
            const statusMapping = {
                "detained": "Ù…ÙˆÙ‚ÙˆÙ",
                "under_review": "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",
                "sentenced": "ØµØ¯Ø± Ø§Ù„Ø­ÙƒÙ…",
                "imprisoned": "ÙÙŠ Ø§Ù„Ø³Ø¬Ù†",
                "released": "Ù…ÙØ±Ø¬ Ø¹Ù†Ù‡",
                "unknown": "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"
            };
            return statusMapping[status] || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
        }

        // Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ù‡ÙˆÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
        const idTypeMap = {
    'civil_registry': 'Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯Ù†ÙŠ',
    'resident_id': 'Ù‡ÙˆÙŠØ© Ù…Ù‚ÙŠÙ…',
    'violator_refugee_id': 'Ù‡ÙˆÙŠØ© Ù…Ø®Ø§Ù„Ù Ù„Ø§Ø¬Ø¦',
    'replacement_card': 'Ø¨Ø·Ø§Ù‚Ø© Ø¨Ø¯ÙŠÙ„Ø©'
};

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem("token");

            if (!token) {
                console.error("Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
                return;
            }

            fetch('https://wethaq-backend.vercel.app/api/cases/', {
                    method: 'GET',
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Token ${token}`
                    }
                })
                .then(response => response.ok ? response.json() : Promise.reject('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'))
                .then(data => {
                    if (!Array.isArray(data)) {
                        console.error("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©");
                        return;
                    }

                    const casesTableBody = document.querySelector('#casesTable tbody');
                    casesTableBody.innerHTML = '';

                    data.forEach(caseItem => {
                        const caseStatus = formatStatus(caseItem.detainee_status || "unknown");

                        const row = document.createElement("tr");
                        row.innerHTML = `
                        <td>${caseItem.detainee.name}</td>
                        <td>${caseItem.detainee.id_number}</td>
                        <td>${caseStatus}</td>
                        <td><button class="btn btn-primary btn-sm" onclick="showFileDetails(${caseItem.id})">Ø¹Ø±Ø¶</button></td>
                    `;
                        casesTableBody.appendChild(row);
                    });
                })
                .catch(error => console.error('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§:', error));
        });

        function showFileDetails(caseId) {
            const token = localStorage.getItem("token");

            if (!token) {
                console.error("Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
                return;
            }

            fetch(`https://wethaq-backend.vercel.app/api/cases/${caseId}/`, {
                    method: 'GET',
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Token ${token}`
                    }
                })
                .then(response => response.ok ? response.json() : Promise.reject('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©'))
                .then(data => {
                    const modalBody = document.querySelector('#fileDetailsModal .modal-body');
                    modalBody.innerHTML = `
                    <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©:</strong> ${data.case_number}</p>
                    <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚ÙˆÙ:</strong> ${data.detainee.name}</p>
                    <p><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</strong> ${data.detainee.id_number}</p>
                    <p><strong>Ø§Ù„Ø¬Ù†Ø³ÙŠØ©:</strong> ${data.detainee.nationality}</p>
                    <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ù‡ÙˆÙŠØ©:</strong> ${idTypeMap[data.detainee.id_type] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</strong> ${data.detainee.date_of_birth}</p>
                    <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${data.detainee.address}</p>
                    <p><strong>Ø§Ù„ØªÙ‡Ù…Ø©:</strong> ${data.charge}</p>
                    <p><strong>Ø¬Ù‡Ø© Ø§Ù„Ù‚Ø¨Ø¶:</strong> ${data.arresting_authority}</p>
                    <p><strong>Ù…ÙƒØ§Ù† Ø§Ù„Ù‚Ø¨Ø¶:</strong> ${data.arresting_place}</p>
                    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø¨Ø¶:</strong> ${data.arresting_date}</p>
                    <p><strong>Ø¬Ù‡Ø© Ø§Ù„ØªÙˆÙ‚ÙŠÙ:</strong> ${data.detention_agency}</p>
                    <p><strong>Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ø¶ÙŠØ©:</strong> ${formatStatus(data.detainee_status || "unknown")}</p>
                `;

                    const modalElement = document.getElementById('fileDetailsModal');
                    const modal = new bootstrap.Modal(modalElement);
                    modal.show();
                })
                .catch(error => console.error('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ø¶ÙŠØ©:', error));
        }
    </script>

</body>

</html>